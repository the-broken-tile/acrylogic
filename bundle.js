(()=>{"use strict";var e;!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(e||(e={}));const t=e,n=function(){function e(e,t){var n=this;this.x=e,this.y=t,this.toString=function(){return"(".concat(n.x,", ").concat(n.y,")")}}return e.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},e.prototype.next=function(n){if(n===t.Up)return new e(this.x,this.y-1);if(n===t.Down)return new e(this.x,this.y+1);if(n===t.Left)return new e(this.x-1,this.y);if(n===t.Right)return new e(this.x+1,this.y);throw new Error("Invalid direction")},e}(),r=function(e,t){this.before=e,this.after=t};var o=function(){function e(e,t,n){this.element=e,this.onLevelChange=t,this.levelManager=n,this.menuToggle=this.element.querySelector("#menu-toggle"),this.levelSelect=this.element.querySelector("#level-select"),this.levelSelectForm=this.element.querySelector("#level-select-form"),this.nextLevelElement=this.element.querySelector("#next-level"),this.update(),this.registerEventListeners()}return e.prototype.close=function(){this.menuToggle.checked=!1,this.levelSelect.value=this.levelManager.current()},e.prototype.handleLevelChange=function(e){e.preventDefault(),this.onLevelChange(this.levelSelect.value)},e.prototype.handleNextLevel=function(){return e=this,t=void 0,r=function(){var e;return function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(u){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){s=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){s.label=l[1];break}if(6===l[0]&&s.label<o[1]){s.label=o[1],o=l;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(l);break}o[2]&&s.ops.pop(),s.trys.pop();continue}l=t.call(e,s)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}}(this,(function(t){switch(t.label){case 0:return[4,this.levelManager.next(this.levelManager.current())];case 1:return null!==(e=t.sent())&&this.onLevelChange(e),[2]}}))},new((n=void 0)||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function l(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}u((r=r.apply(e,t||[])).next())}));var e,t,n,r},e.prototype.registerEventListeners=function(){this.levelSelectForm.addEventListener("submit",this.handleLevelChange.bind(this)),this.nextLevelElement.addEventListener("click",this.handleNextLevel.bind(this))},e.prototype.update=function(){this.levelSelect.value=this.levelManager.current()},e}();const i=o,s=function(){function e(e){this.onHashChange=e,window.addEventListener("popstate",this.handlePopState.bind(this))}return e.prototype.setLevel=function(e){history.pushState({},"","#".concat(e))},e.prototype.handlePopState=function(){var e=window.location.hash.match(/#((o3|o4|tbt)-\d+)/);if(null!==e){var t=e[1];this.onHashChange(t)}},e}();var l,u;!function(e){e[e.White=0]="White",e[e.Blue=1]="Blue",e[e.Red=2]="Red",e[e.Yellow=4]="Yellow",e[e.Purple=3]="Purple",e[e.Orange=6]="Orange",e[e.Green=5]="Green",e[e.Black=1/0]="Black"}(u||(u={}));var c=((l={})[u.White]="White",l[u.Blue]="Blue",l[u.Red]="Red",l[u.Yellow]="Yellow",l[u.Purple]="Purple",l[u.Orange]="Orange",l[u.Green]="Green",l[u.Black]="Black",l);const a=u,h=function(){function e(e,t){this.color=e,this.selected=t}return e.prototype.toString=function(){return'<button tabindex="-1" class="color-select color-'.concat(this.color.toString()).concat(this.selected?" selected":"",'" value="').concat(this.color.toString(),'"></button>')},e}(),d=function(){function e(e,t){this.number=e,this.selected=t}return e.prototype.toString=function(){return'<button tabindex="-1" class="number-select'.concat(this.selected?" selected":"",'" value="').concat(this.number,'">').concat(this.number,"</button>")},e}();var p;!function(e){e[e.color=0]="color",e[e.number=1]="number"}(p||(p={}));const f=function(){function e(e,t){this.type=e,this.value=t}return e.Type=p,e}();var v,g,y=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};!function(e){e[e.Single=0]="Single",e[e.Multiple=1]="Multiple"}(g||(g={}));var m={w:a.White,u:a.Blue,b:a.Black,r:a.Red,g:a.Green,y:a.Yellow,p:a.Purple,o:a.Orange},b={1:1,2:2,3:3,4:4,5:5},C=((v={})[a.White.toString()]=a.White,v[a.Black.toString()]=a.Black,v[a.Blue.toString()]=a.Blue,v[a.Red.toString()]=a.Red,v[a.Yellow.toString()]=a.Yellow,v);const w=function(){function e(e,t,n){var r=this;this.root=e,this.el=t,this.onOk=n,this.availableColors=[],this.availableNumbers=[],this.selectedColors=[],this.selectedNumbers=[],this.type=g.Single,this.render=function(){return'\n        <div id="color-select"></div><div>\n        <div id="number-select"></div>\n        <div>\n            <button id="dialog-ok">Ok</button>\n            <button id="dialog-cancel">Cancel</button>\n        </div>'},this.renderColorOptions=function(){return r.availableColors.map((function(e){return new h(e,r.selectedColors.includes(e)).toString()})).join("")},this.renderNumberOptions=function(){return r.availableNumbers.map((function(e){return new d(e,r.selectedNumbers.includes(e)).toString()})).join("")},this.el.innerHTML=this.render(),this.ok=this.el.querySelector("#dialog-ok"),this.cancel=this.el.querySelector("#dialog-cancel"),this.colorSelect=this.el.querySelector("#color-select"),this.numberSelect=this.el.querySelector("#number-select"),this.registerEvents()}return e.prototype.handleOk=function(){this.el.close(),this.onOk(this.getSelection())},e.prototype.getSelection=function(){return y(y([],this.getSelectedColors().map((function(e){return new f(f.Type.color,e)})),!0),this.getSelectedNumbers().map((function(e){return new f(f.Type.number,e)})),!0)},e.prototype.update=function(){this.colorSelect.innerHTML=this.renderColorOptions(),this.numberSelect.innerHTML=this.renderNumberOptions()},e.prototype.open=function(e,t,n,r,o){this.resetForm(),this.type=o,this.availableColors=n,this.selectedColors=e,this.selectedNumbers=t,this.availableNumbers=r,this.update(),this.el.showModal()},e.prototype.close=function(){this.el.close()},e.prototype.handleCancel=function(){this.close()},e.prototype.isOpen=function(){return this.el.open},e.prototype.getSelectedColors=function(){return this.selectedColors},e.prototype.getSelectedNumbers=function(){return this.selectedNumbers},e.prototype.handleKeyboardEvent=function(e){if(this.isOpen()){var t=e.key;if("Escape"===t)return e.preventDefault(),void this.close();if("Enter"===t)return this.handleOk(),void e.preventDefault();if("Backspace"===t)return this.resetForm(),this.selectedNumbers=[],this.selectedColors=[],this.update(),void e.preventDefault();if(m.hasOwnProperty(t)){e.preventDefault();var n=m[t];return this.selectedColors.includes(n)?(this.selectedColors=this.selectedColors.filter((function(e){return e!==n})),void this.update()):(this.selectedColors.push(n),void this.update())}if(b.hasOwnProperty(t)){e.preventDefault();var r=b[t];return this.selectedNumbers.includes(r)?(this.selectedNumbers=this.selectedNumbers.filter((function(e){return e!==r})),void this.update()):(this.selectedNumbers.push(r),void this.update())}}},e.prototype.resetForm=function(){this.selectedColors=[],this.selectedNumbers=[],this.colorSelect.innerHTML=""},e.prototype.registerEvents=function(){this.ok.addEventListener("click",this.handleOk.bind(this)),this.cancel.addEventListener("click",this.handleCancel.bind(this)),this.root.addEventListener("keyup",this.handleKeyboardEvent.bind(this)),this.el.addEventListener("click",this.handleClick.bind(this))},e.prototype.handleClick=function(e){var t=e.target;if(t instanceof HTMLButtonElement){var n=t.value;if(t.classList.contains("color-select")){var r=C[n];return this.selectedColors.includes(r)?this.selectedColors=this.selectedColors.filter((function(e){return e!==r})):this.selectedColors.push(r),void this.update()}var o=parseInt(n,10);this.selectedNumbers.includes(o)?this.selectedNumbers=this.selectedNumbers.filter((function(e){return e!==o})):this.selectedNumbers.push(o),this.update()}},e.Type=g,e}(),S=function(e,t){return void 0===t&&(t={}),fetch(e,t).then((function(e){return e.json()})).then((function(e){return e}))},k=function(){function e(e,t,n,r){this.grid=e,this.clues=t,this.numbers=n,this.colors=r}return e.prototype.getGrid=function(){return this.grid},e.prototype.getCell=function(e){return this.grid.getCell(e)},e.prototype.getClues=function(){return this.clues},e.prototype.getColors=function(){return this.colors},e.prototype.getNumbers=function(){return this.numbers},e.prototype.getHeight=function(){return this.grid.cells.length},e.prototype.getWidth=function(){return this.grid.cells[0].length},e.prototype.getClue=function(e,t){return this.clues.find((function(n){return n.coordinate.equals(e)&&n.direction===t}))},e.prototype.isComplete=function(){return this.grid.cells.every((function(e){return e.every((function(e){return e.isComplete()}))}))},e}(),N=function(e){this.numberCandidates=e.getNumberCandidates(),this.colorCandidates=e.getColorCandidates(),this.colorGuess=e.getColorGuess(),this.numberGuess=e.getNumberGuess(),this.coordinate=e.coordinate},E=function(){function e(e,t,n){var r=this;this.numberCandidates=[],this.colorCandidates=[],this.colorGuess=void 0,this.numberGuess=void 0,this.toString=function(){return"".concat(r.color,"/").concat(r.number," ").concat(r.coordinate.toString())},this.color=e,this.number=t,this.coordinate=n}return e.prototype.isComplete=function(){return this.number===this.numberGuess&&this.color===this.colorGuess},e.prototype.getColorGuess=function(){return this.colorGuess},e.prototype.getNumberGuess=function(){return this.numberGuess},e.prototype.setColorGuess=function(e){this.colorGuess=e,void 0!==e&&(this.colorCandidates=[])},e.prototype.setNumberGuess=function(e){this.numberGuess=e,void 0!==e&&(this.numberCandidates=[])},e.prototype.getColorCandidates=function(){return this.colorCandidates},e.prototype.addColorCandidate=function(e){this.colorCandidates.includes(e)||this.colorCandidates.push(e)},e.prototype.resetColorCandidates=function(){this.colorCandidates=[]},e.prototype.getNumberCandidates=function(){return this.numberCandidates},e.prototype.addNumberCandidate=function(e){this.numberCandidates.includes(e)||this.numberCandidates.push(e)},e.prototype.resetNumberCandidates=function(){this.numberCandidates=[]},e.prototype.getState=function(){return new N(this)},e.prototype.setState=function(e){this.colorCandidates=e.colorCandidates,this.numberCandidates=e.numberCandidates,this.colorGuess=e.colorGuess,this.numberGuess=e.numberGuess},e}(),G=function(){function e(e){this._cells=e}return Object.defineProperty(e.prototype,"cells",{get:function(){return this._cells},enumerable:!1,configurable:!0}),e.prototype.getCell=function(e){return this._cells[e.y][e.x]},e}(),L=function(e,t,n,r,o){this.coordinate=e,this.direction=t,this.color=n,this.number=r,this.not=o};var x={up:t.Up,down:t.Down,left:t.Left,right:t.Right},O={white:a.White,blue:a.Blue,red:a.Red,yellow:a.Yellow,purple:a.Purple,orange:a.Orange,green:a.Green,black:a.Black};const H=function(){function e(){var e=this;this.buildGrid=function(t){return new G(t.map((function(t,n){return e.mapRow(t,n)})))},this.mapRow=function(t,n){return t.map((function(t,r){return e.mapCell(t,n,r)}))},this.mapCell=function(e,t,r){return new E(O[e.color],e.number,new n(r,t))},this.buildClues=function(t){return t.map((function(t){return e.buildClue(t)}))},this.buildClue=function(e){return new L(new n(e.x,e.y),x[e.direction],e.color?O[e.color]:void 0,e.number,e.not)}}return e.prototype.build=function(e){return new k(this.buildGrid(e.grid),this.buildClues(e.clues),e.numbers,e.colors.map((function(e){return O[e]})))},e}();var B=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function l(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}u((r=r.apply(e,t||[])).next())}))},T=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(u){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){s=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){s.label=l[1];break}if(6===l[0]&&s.label<o[1]){s.label=o[1],o=l;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(l);break}o[2]&&s.ops.pop(),s.trys.pop();continue}l=t.call(e,s)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}},M=function(){function e(e,t,n,r){this.root=e,this.levelManager=t,this.renderer=n,this.gameHistory=r,this.enteringCandidates=!1,this.gameBuilder=new H,this.urlState=new s(this.handleHashChange.bind(this)),this.gameElement=this.root.querySelector("#game"),this.dialog=new w(this.root,this.root.querySelector("#dialog"),this.handleDialogOk.bind(this)),this.menu=new i(this.root.querySelector("#menu"),this.handleLevelChange.bind(this),this.levelManager),this.registerListeners()}return e.prototype.registerListeners=function(){var e,t,n=this;this.root.addEventListener("click",this.handleCellClick.bind(this)),this.gameHistory.registerUndo(this.handleUndo.bind(this)),null===(e=this.root.querySelector("#undo"))||void 0===e||e.addEventListener("click",(function(){return n.gameHistory.undo()})),null===(t=this.root.querySelector("#redo"))||void 0===t||t.addEventListener("click",(function(){return n.gameHistory.redo()}))},e.prototype.handleCellClick=function(e){if(!this.dialog.isOpen()&&void 0!==this.game){var t=e.target;if(null!==t){var r=this.closest(t,".cell");if(null!==r){var o=r.dataset.x,i=r.dataset.y,s=new n(parseInt(o,10),parseInt(i,10));this.currentCell=this.game.getCell(s),this.enteringCandidates=null!==this.closest(t,".candidates"),this.dialog.open(this.enteringCandidates?this.currentCell.getColorCandidates():[this.currentCell.getColorGuess()].filter((function(e){return void 0!==e})),this.enteringCandidates?this.currentCell.getNumberCandidates():[this.currentCell.getNumberGuess()].filter((function(e){return void 0!==e})),this.game.getColors(),this.game.getNumbers(),this.enteringCandidates?w.Type.Multiple:w.Type.Single)}}}},e.prototype.handleLevelChange=function(e){return B(this,void 0,void 0,(function(){return T(this,(function(t){switch(t.label){case 0:return[4,this.newGame(e).catch((function(){alert("No such level: ".concat(e))}))];case 1:return t.sent(),this.menu.close(),[2]}}))}))},e.prototype.handleDialogOk=function(e){if(void 0===this.currentCell)throw new Error("currentCell is undefined");if(void 0===this.game)throw new Error("game is undefined");var t=this.currentCell;this.currentCell=void 0;var n=t.getState();if(this.enteringCandidates)return t.resetColorCandidates(),t.resetNumberCandidates(),e.forEach((function(e){if(e.type!==f.Type.color){var n=e.value;t.addNumberCandidate(n)}else{var r=e.value;t.addColorCandidate(r)}})),this.update(),void this.gameHistory.addEvent(new r(n,t.getState()));t.setNumberGuess(void 0),t.setColorGuess(void 0),e.forEach((function(e){if(e.type!==f.Type.number){var n=e.value;t.setColorGuess(n)}else{var r=e.value;t.setNumberGuess(r)}})),this.gameHistory.addEvent(new r(n,t.getState())),this.update(),this.winCheck()},e.prototype.init=function(){return B(this,void 0,void 0,(function(){var e;return T(this,(function(t){switch(t.label){case 0:return e=this.levelManager.current(),[4,this.newGame(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.newGame=function(e,t){return void 0===t&&(t=!1),B(this,void 0,void 0,(function(){var n;return T(this,(function(r){switch(r.label){case 0:return[4,S("./api/game/".concat(e,".json"))];case 1:return n=r.sent(),this.game=this.gameBuilder.build(n),t||this.urlState.setLevel(e),this.levelManager.setLevel(e),this.update(),[2]}}))}))},e.prototype.winCheck=function(){var e;(null===(e=this.game)||void 0===e?void 0:e.isComplete())&&setTimeout((function(){return alert("Victory!")}),0)},e.prototype.closest=function(e,t){return e.matches(t)?e:null===e.parentElement?null:this.closest(e.parentElement,t)},e.prototype.handleHashChange=function(e){this.newGame(e,!0).catch((function(){alert("No such level: ".concat(e))}))},e.prototype.handleUndo=function(e){void 0!==this.game&&(this.game.getCell(e.coordinate).setState(e),this.update())},e.prototype.update=function(){var e,t;void 0!==this.game&&(null===(e=this.root.querySelector("#undo"))||void 0===e||e.classList.toggle("disabled",!this.gameHistory.hasUndo()),null===(t=this.root.querySelector("#redo"))||void 0===t||t.classList.toggle("disabled",!this.gameHistory.hasRedo()),this.renderer.render(this.gameElement,this.game))},e}();const R=M;var q="gameID";const U=function(){function e(e){this.storage=e}return e.prototype.setId=function(e){this.storage.setItem(q,JSON.stringify(e))},e.prototype.getId=function(){var e=this.storage.getItem(q);return null===e?null:JSON.parse(e)},e}(),D=function(){function e(){}return e.prototype.render=function(e,t){var n=this,r=e.parentElement;r.removeChild(e),e.innerHTML='<div class="game rows-'.concat(t.getHeight()," cols-").concat(t.getWidth(),'">\n            <div class="horizontal-border"></div>\n            ').concat(t.getGrid().cells.map((function(e){return n.renderRow(e,t)}),this).join(""),"\n        </div>"),r.appendChild(e)},e.prototype.renderRow=function(e,t){var n=this;return'\n            <div class="row">\n                <div class="vertical-border"></div>\n                '.concat(e.map((function(e){return n.renderCell(e,t)}),this).join(""),'\n            </div>\n            <div class="row">\n                ').concat(this.renderHorizontalClues(e,t),"\n            </div>\n        ")},e.prototype.renderCell=function(e,n){var r=n.getClue(e.coordinate,t.Right);return'\n            <div class="cell'.concat(this.renderCellClassName(e),'"\n                data-x="').concat(e.coordinate.x,'"\n                data-y="').concat(e.coordinate.y,'"\n            >\n                ').concat(this.renderCellValue(e),'\n                <div class="candidates">').concat(this.renderCandidates(e),'</div>\n            </div>\n            <div class="vertical-border').concat(this.renderClueClassName(r),'">\n                ').concat(this.renderClueValue(r),"\n            </div>\n        ")},e.prototype.renderCellValue=function(e){var t=e.getNumberGuess();return void 0!==t?"".concat(t):""},e.prototype.renderCellClassName=function(e){var t=e.getColorGuess();return void 0===t?"":" color-".concat(t)},e.prototype.renderClueValue=function(e){if(void 0===e)return"";var t=void 0!==e.color?c[e.color]:"".concat(e.number);return'<span class="clue'.concat(!0===e.not?" not":"",'">').concat(t,"</span>")},e.prototype.renderClueClassName=function(e){return void 0===e||void 0===e.color?"":" color-".concat(e.color)},e.prototype.renderHorizontalClues=function(e,t){var n=this;return"<div></div>".concat(e.map((function(e){return n.renderHorizontalClue(e,t)})).join(""))},e.prototype.renderHorizontalClue=function(e,n){var r=n.getClue(e.coordinate,t.Down);return'\n            <div class="horizontal-border'.concat(this.renderClueClassName(r),'">\n                ').concat(this.renderClueValue(r),"\n            </div>\n            <div></div>")},e.prototype.renderCandidates=function(e){return"\n            <ul>".concat(e.getColorCandidates().map((function(e){return'<li class="color-'.concat(e,' color-candidate">&nbsp;</li>')})).join(""),"</ul>\n            <ul>").concat(e.getNumberCandidates().map((function(e){return"<li>".concat(e,"</li>")})).join(""),"</ul>\n        ")},e}();var I=["o3","o4","tbt"],P=function(){function e(e){this.store=e}return e.prototype.setLevel=function(e){this.store.setId(e)},e.prototype.current=function(){var e;return null!==(e=this.store.getId())&&void 0!==e?e:"o3-1"},e.prototype.next=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,i;return function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(u){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){s=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){s.label=l[1];break}if(6===l[0]&&s.label<o[1]){s.label=o[1],o=l;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(l);break}o[2]&&s.ops.pop(),s.trys.pop();continue}l=t.call(e,s)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}}(this,(function(s){switch(s.label){case 0:if(null===(t=e.match(/^(o3|o4|tbt)/)))throw new Error("Invalid level: ".concat(e));return n=t[1],r=e.replace(/(\d+)$/,(function(e,t){return"".concat(parseInt(t,10)+1)})),o=!0,[4,S("./api/game/".concat(r,".json")).catch((function(){o=!1}))];case 1:return s.sent(),o?[2,r]:(i=I.indexOf(n)+1)===I.length?[2,null]:[2,"".concat(I[i],"-1")]}}))},new((r=void 0)||(r=Promise))((function(e,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function l(e){try{u(o.throw(e))}catch(e){i(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,l)}u((o=o.apply(t,n||[])).next())}));var t,n,r,o},e}();const j=P,W=function(){function e(){this.gameEvents=[],this.redoStack=[],this.onUndo=function(){},this.registerEvents()}return e.prototype.addEvent=function(e){this.redoStack.length>0&&(this.redoStack=[]),this.gameEvents.push(e)},e.prototype.registerUndo=function(e){this.onUndo=e},e.prototype.registerEvents=function(){window.addEventListener("keyup",this.handleKeyUp.bind(this))},e.prototype.handleKeyUp=function(e){var t=e.key;(e.ctrlKey||e.metaKey)&&("z"===t&&this.undo(),"y"===t&&this.redo())},e.prototype.undo=function(){if(0!==this.gameEvents.length){var e=this.gameEvents.pop();this.redoStack.push(e),this.onUndo(e.before)}},e.prototype.redo=function(){if(0!==this.redoStack.length){var e=this.redoStack.pop();this.gameEvents.push(e),this.onUndo(e.after)}},e.prototype.hasUndo=function(){return this.gameEvents.length>0},e.prototype.hasRedo=function(){return this.redoStack.length>0},e}();new R(window.document.getElementById("app"),new j(new U(window.localStorage)),new D,new W).init()})();