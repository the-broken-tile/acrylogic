(()=>{"use strict";var t;!function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right"}(t||(t={}));const e=t,n=function(){function t(t,e){var n=this;this.x=t,this.y=e,this.toString=function(){return"(".concat(n.x,", ").concat(n.y,")")}}return t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.next=function(n){if(n===e.Up)return new t(this.x,this.y-1);if(n===e.Down)return new t(this.x,this.y+1);if(n===e.Left)return new t(this.x-1,this.y);if(n===e.Right)return new t(this.x+1,this.y);throw new Error("Invalid direction")},t}(),r=function(t,e){this.before=t,this.after=e};var i=function(){function t(t,e,n){this.element=t,this.onLevelChange=e,this.levelManager=n,this.menuToggle=this.element.querySelector("#menu-toggle"),this.levelSelect=this.element.querySelector("#level-select"),this.levelSelectForm=this.element.querySelector("#level-select-form"),this.nextLevelElement=this.element.querySelector("#next-level"),this.update(),this.registerEventListeners()}return t.prototype.close=function(){this.menuToggle.checked=!1,this.levelSelect.value=this.levelManager.current()},t.prototype.handleLevelChange=function(t){t.preventDefault(),this.onLevelChange(this.levelSelect.value)},t.prototype.handleNextLevel=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==l[0]&&2!==l[0])){s=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){s.label=l[1];break}if(6===l[0]&&s.label<i[1]){s.label=i[1],i=l;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(l);break}i[2]&&s.ops.pop(),s.trys.pop();continue}l=e.call(t,s)}catch(t){l=[6,t],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}}(this,(function(e){switch(e.label){case 0:return[4,this.levelManager.next(this.levelManager.current())];case 1:return null!==(t=e.sent())&&this.onLevelChange(t),[2]}}))},new((n=void 0)||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function l(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,l)}c((r=r.apply(t,e||[])).next())}));var t,e,n,r},t.prototype.registerEventListeners=function(){this.levelSelectForm.addEventListener("submit",this.handleLevelChange.bind(this)),this.nextLevelElement.addEventListener("click",this.handleNextLevel.bind(this))},t.prototype.update=function(){this.levelSelect.value=this.levelManager.current()},t}();const o=i,s=function(){function t(t){this.onHashChange=t,window.addEventListener("popstate",this.handlePopState.bind(this))}return t.prototype.setLevel=function(t){history.pushState({},"","#".concat(t))},t.prototype.handlePopState=function(){var t=window.location.hash.match(/#((o3|o4|o5|tbt)-\d+)/);if(null!==t){var e=t[1];this.onHashChange(e)}},t}();var l,c;!function(t){t[t.White=0]="White",t[t.Blue=1]="Blue",t[t.Red=2]="Red",t[t.Yellow=4]="Yellow",t[t.Purple=3]="Purple",t[t.Orange=6]="Orange",t[t.Green=5]="Green",t[t.Black=1/0]="Black"}(c||(c={}));var u=((l={})[c.White]="White",l[c.Blue]="Blue",l[c.Red]="Red",l[c.Yellow]="Yellow",l[c.Purple]="Purple",l[c.Orange]="Orange",l[c.Green]="Green",l[c.Black]="Black",l);const a=c,h=function(){function t(t,e){this.color=t,this.selected=e}return t.prototype.toString=function(){return'<button tabindex="-1" class="color color-select color-'.concat(this.color.toString()).concat(this.selected?" selected":"",'" value="').concat(this.color.toString(),'"></button>')},t}(),d=function(){function t(t,e){this.number=t,this.selected=e}return t.prototype.toString=function(){return'<button tabindex="-1" class="number-select'.concat(this.selected?" selected":"",'" value="').concat(this.number,'">').concat(this.number,"</button>")},t}();var p;!function(t){t[t.color=0]="color",t[t.number=1]="number"}(p||(p={}));const f=function(){function t(t,e){this.type=t,this.value=e}return t.Type=p,t}();var v,g,m=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};!function(t){t[t.Single=0]="Single",t[t.Multiple=1]="Multiple"}(g||(g={}));var y={w:a.White,u:a.Blue,b:a.Black,r:a.Red,g:a.Green,y:a.Yellow,p:a.Purple,o:a.Orange},b={0:0,1:1,2:2,3:3,4:4,5:5},C=((v={})[a.White.toString()]=a.White,v[a.Black.toString()]=a.Black,v[a.Blue.toString()]=a.Blue,v[a.Red.toString()]=a.Red,v[a.Yellow.toString()]=a.Yellow,v);const w=function(){function t(t,e,n){var r=this;this.root=t,this.el=e,this.onOk=n,this.availableColors=[],this.availableNumbers=[],this.selectedColors=[],this.selectedNumbers=[],this.type=g.Single,this.render=function(){return'\n        <div id="color-select"></div><div>\n        <div id="number-select"></div>\n        <div>\n            <button id="dialog-ok">Ok</button>\n            <button id="dialog-cancel">Cancel</button>\n        </div>'},this.renderColorOptions=function(){return r.availableColors.map((function(t){return new h(t,r.selectedColors.includes(t)).toString()})).join("")},this.renderNumberOptions=function(){return r.availableNumbers.map((function(t){return new d(t,r.selectedNumbers.includes(t)).toString()})).join("")},this.el.innerHTML=this.render(),this.ok=this.el.querySelector("#dialog-ok"),this.cancel=this.el.querySelector("#dialog-cancel"),this.colorSelect=this.el.querySelector("#color-select"),this.numberSelect=this.el.querySelector("#number-select"),this.registerEvents()}return t.prototype.handleOk=function(){this.el.close(),this.onOk(this.getSelection())},t.prototype.getSelection=function(){return m(m([],this.getSelectedColors().map((function(t){return new f(f.Type.color,t)})),!0),this.getSelectedNumbers().map((function(t){return new f(f.Type.number,t)})),!0)},t.prototype.update=function(){this.colorSelect.innerHTML=this.renderColorOptions(),this.numberSelect.innerHTML=this.renderNumberOptions()},t.prototype.open=function(t,e,n,r,i){this.resetForm(),this.type=i,this.availableColors=n,this.selectedColors=t,this.selectedNumbers=e,this.availableNumbers=r,this.update(),this.el.showModal()},t.prototype.close=function(){this.el.close()},t.prototype.handleCancel=function(){this.close()},t.prototype.isOpen=function(){return this.el.open},t.prototype.getSelectedColors=function(){return this.selectedColors},t.prototype.getSelectedNumbers=function(){return this.selectedNumbers},t.prototype.handleKeyboardEvent=function(t){if(this.isOpen()){var e=t.key;if("Escape"===e)return t.preventDefault(),void this.close();if("Enter"===e)return this.handleOk(),void t.preventDefault();if("Backspace"===e)return this.resetForm(),this.selectedNumbers=[],this.selectedColors=[],this.update(),void t.preventDefault();if(y.hasOwnProperty(e)){t.preventDefault();var n=y[e];return this.selectedColors.includes(n)?(this.selectedColors=this.selectedColors.filter((function(t){return t!==n})),void this.update()):(this.selectedColors.push(n),void this.update())}if(b.hasOwnProperty(e)){t.preventDefault();var r=b[e];if(this.selectedNumbers.includes(r))return this.selectedNumbers=this.selectedNumbers.filter((function(t){return t!==r})),void this.update();this.selectedNumbers.push(r),this.update()}}},t.prototype.resetForm=function(){this.selectedColors=[],this.selectedNumbers=[]},t.prototype.registerEvents=function(){this.ok.addEventListener("click",this.handleOk.bind(this)),this.cancel.addEventListener("click",this.handleCancel.bind(this)),this.root.addEventListener("keyup",this.handleKeyboardEvent.bind(this)),this.el.addEventListener("click",this.handleClick.bind(this))},t.prototype.handleClick=function(t){var e=t.target;if(e instanceof HTMLButtonElement){var n=e.value;if(e.classList.contains("color-select")){var r=C[n];return this.selectedColors.includes(r)?this.selectedColors=this.selectedColors.filter((function(t){return t!==r})):this.selectedColors.push(r),void this.update()}var i=parseInt(n,10);this.selectedNumbers.includes(i)?this.selectedNumbers=this.selectedNumbers.filter((function(t){return t!==i})):this.selectedNumbers.push(i),this.update()}},t.Type=g,t}();var S=function(){function t(t){var e=this;this.cell=t,this.toString=function(){var t;return'\n        <div\n            class="'.concat(e.getClassName(),'"\n            data-x="').concat(e.cell.coordinate.x,'"\n            data-y="').concat(e.cell.coordinate.y,'"\n        >\n            <span class="cell-content">').concat(null!==(t=e.cell.getNumberGuess())&&void 0!==t?t:"",'</span>\n            <div class="candidates">').concat(e.renderCandidates(),"</div>\n        </div>\n    ")}}return t.prototype.renderCandidates=function(){return"\n            <ul>".concat(this.cell.getColorCandidates().map((function(t){return'<li class="color color-'.concat(t,' color-candidate">&nbsp;</li>')})).join(""),"</ul>\n            <ul>").concat(this.cell.getNumberCandidates().map((function(t){return"<li>".concat(t,"</li>")})).join(""),"</ul>\n        ")},t.prototype.getClassName=function(){var t=["cell"],e=this.cell.getColorGuess();return void 0!==e&&(t.push("color"),t.push("color-".concat(e))),t.join(" ")},t}();const k=S;var E;!function(t){t[t.horizontal=0]="horizontal",t[t.vertical=1]="vertical"}(E||(E={}));const N=function(){function t(t,e){this.clue=t,this.type=e}return t.prototype.toString=function(){return this.type===E.horizontal?this.renderHorizontalClue():this.renderVerticalClue()},t.prototype.renderHorizontalClue=function(){return'\n            <div class="horizontal-border color '.concat(this.renderClueClassName(),'">\n                ').concat(this.renderClueValue(),"\n            </div>\n            <div></div>")},t.prototype.renderVerticalClue=function(){return'<div class="vertical-border color '.concat(this.renderClueClassName(),'">\n            ').concat(this.renderClueValue(),"\n        </div>")},t.prototype.renderClueValue=function(){if(void 0===this.clue)return"";var t=void 0!==this.clue.color?u[this.clue.color]:"".concat(this.clue.number);return'<span class="clue'.concat(!0===this.clue.not?" not":"",'">').concat(t,"</span>")},t.prototype.renderClueClassName=function(){var t=[];return void 0===this.clue?"":(void 0!==this.clue.color&&t.push("color-".concat(this.clue.color)),void 0!==this.clue.number&&(t.push("number-".concat(this.clue.number)),t.push("number-clue")),t.join(" "))},t.TYPE=E,t}(),G=function(){function t(t,e){this.cells=t,this.game=e}return t.prototype.toString=function(){var t=this;return'\n            <div class="row">\n                <div class="color vertical-border"></div>\n                '.concat(this.cells.map((function(n){return"\n                            ".concat(new k(n),"\n                            ").concat(new N(t.game.getClue(n.coordinate,e.Right),N.TYPE.vertical),"\n                        ")})).join(""),'\n            </div>\n            <div class="row">\n                <div></div>\n                ').concat(this.cells.map((function(n){return new N(t.game.getClue(n.coordinate,e.Down),N.TYPE.horizontal)})).join(""),"\n            </div>\n        ")},t}(),L=function(){function t(t){this.game=t}return t.prototype.toString=function(){var t=this;return'<div class="grid rows-'.concat(this.game.getHeight()," cols-").concat(this.game.getWidth(),'">\n            ').concat(this.renderFirstRow(),"\n            ").concat(this.game.getGrid().cells.map((function(e){return new G(e,t.game)})).join(""),"\n        </div>")},t.prototype.renderFirstRow=function(){for(var t='<div class="row"><div></div>',e=0;e<this.game.getWidth();e++)t+='<div class="horizontal-border color"></div><div></div>';return t+"</div>"},t}(),x=function(t,e){return void 0===e&&(e={}),fetch(t,e).then((function(t){return t.json()})).then((function(t){return t}))};const O=function(){function t(t,e,n,r){this.grid=t,this.clues=e,this.numbers=n,this.colors=r}return t.prototype.getGrid=function(){return this.grid},t.prototype.getCell=function(t){return this.grid.getCell(t)},t.prototype.getClues=function(){return this.clues},t.prototype.getColors=function(){return this.colors},t.prototype.getNumbers=function(){return this.numbers},t.prototype.getHeight=function(){return this.grid.cells.length},t.prototype.getWidth=function(){return this.grid.cells[0].length},t.prototype.getClue=function(t,e){return this.clues.find((function(n){return n.coordinate.equals(t)&&n.direction===e}))},t.prototype.isComplete=function(){return this.grid.cells.every((function(t){return t.every((function(t){return t.isComplete()}))}))},t}(),B=function(t){this.numberCandidates=t.getNumberCandidates(),this.colorCandidates=t.getColorCandidates(),this.colorGuess=t.getColorGuess(),this.numberGuess=t.getNumberGuess(),this.coordinate=t.coordinate};var H=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},R=function(){function t(t,e,n){var r=this;this.numberCandidates=[],this.colorCandidates=[],this.colorGuess=void 0,this.numberGuess=void 0,this.toString=function(){return"".concat(r.color,"/").concat(r.number," ").concat(r.coordinate.toString())},this.color=t,this.number=e,this.coordinate=n}return t.prototype.isComplete=function(){return this.number===this.numberGuess&&this.color===this.colorGuess},t.prototype.getColorGuess=function(){return this.colorGuess},t.prototype.getNumberGuess=function(){return this.numberGuess},t.prototype.setColorGuess=function(t){this.colorGuess=t,void 0!==t&&(this.colorCandidates=[])},t.prototype.setNumberGuess=function(t){this.numberGuess=t,void 0!==t&&(this.numberCandidates=[])},t.prototype.getColorCandidates=function(){return H([],this.colorCandidates,!0)},t.prototype.addColorCandidate=function(t){this.colorCandidates.includes(t)||this.colorCandidates.push(t)},t.prototype.resetColorCandidates=function(){this.colorCandidates=[]},t.prototype.getNumberCandidates=function(){return H([],this.numberCandidates,!0)},t.prototype.addNumberCandidate=function(t){this.numberCandidates.includes(t)||this.numberCandidates.push(t)},t.prototype.resetNumberCandidates=function(){this.numberCandidates=[]},t.prototype.getState=function(){return new B(this)},t.prototype.setState=function(t){this.colorCandidates=t.colorCandidates,this.numberCandidates=t.numberCandidates,this.colorGuess=t.colorGuess,this.numberGuess=t.numberGuess},t}();const T=R,M=function(){function t(t){this._cells=t}return Object.defineProperty(t.prototype,"cells",{get:function(){return this._cells},enumerable:!1,configurable:!0}),t.prototype.getCell=function(t){return this._cells[t.y][t.x]},t}(),q=function(t,e,n,r,i){this.coordinate=t,this.direction=e,this.color=n,this.number=r,this.not=i};var P={up:e.Up,down:e.Down,left:e.Left,right:e.Right},U={white:a.White,blue:a.Blue,red:a.Red,yellow:a.Yellow,purple:a.Purple,orange:a.Orange,green:a.Green,black:a.Black};const I=function(){function t(){var t=this;this.buildGrid=function(e){return new M(e.map((function(e,n){return t.mapRow(e,n)})))},this.mapRow=function(e,n){return e.map((function(e,r){return t.mapCell(e,n,r)}))},this.mapCell=function(t,e,r){return new T(U[t.color],t.number,new n(r,e))},this.buildClues=function(e){return e.map((function(e){return t.buildClue(e)}))},this.buildClue=function(t){return new q(new n(t.x,t.y),P[t.direction],t.color?U[t.color]:void 0,t.number,t.not)}}return t.prototype.build=function(t){return new O(this.buildGrid(t.grid),this.buildClues(t.clues),t.numbers,t.colors.map((function(t){return U[t]})))},t}();var z=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function l(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,l)}c((r=r.apply(t,e||[])).next())}))},D=function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==l[0]&&2!==l[0])){s=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){s.label=l[1];break}if(6===l[0]&&s.label<i[1]){s.label=i[1],i=l;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(l);break}i[2]&&s.ops.pop(),s.trys.pop();continue}l=e.call(t,s)}catch(t){l=[6,t],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},j=function(){function t(t,e,n,r){this.root=t,this.levelManager=e,this.gameHistory=n,this.resizer=r,this.enteringCandidates=!1,this.gameBuilder=new I,this.urlState=new s(this.handleHashChange.bind(this)),this.gameElement=this.root.querySelector("#game"),this.dialog=new w(this.root,this.root.querySelector("#dialog"),this.handleDialogOk.bind(this)),this.menu=new o(this.root.querySelector("#menu"),this.handleLevelChange.bind(this),this.levelManager),this.registerListeners()}return t.prototype.registerListeners=function(){var t,e,n=this;this.root.addEventListener("click",this.handleCellClick.bind(this)),this.gameHistory.registerUndo(this.handleUndo.bind(this)),null===(t=this.root.querySelector("#undo"))||void 0===t||t.addEventListener("click",(function(){return n.gameHistory.undo()})),null===(e=this.root.querySelector("#redo"))||void 0===e||e.addEventListener("click",(function(){return n.gameHistory.redo()}))},t.prototype.handleCellClick=function(t){if(!this.dialog.isOpen()&&void 0!==this.game){var e=t.target;if(null!==e){var r=this.closest(e,".cell");if(null!==r){var i=r.dataset.x,o=r.dataset.y,s=new n(parseInt(i,10),parseInt(o,10));this.currentCell=this.game.getCell(s),this.enteringCandidates=null!==this.closest(e,".candidates"),this.dialog.open(this.enteringCandidates?this.currentCell.getColorCandidates():[this.currentCell.getColorGuess()].filter((function(t){return void 0!==t})),this.enteringCandidates?this.currentCell.getNumberCandidates():[this.currentCell.getNumberGuess()].filter((function(t){return void 0!==t})),this.game.getColors(),this.game.getNumbers(),this.enteringCandidates?w.Type.Multiple:w.Type.Single)}}}},t.prototype.handleLevelChange=function(t){return z(this,void 0,void 0,(function(){return D(this,(function(e){switch(e.label){case 0:return[4,this.newGame(t).catch((function(){alert("No such level: ".concat(t))}))];case 1:return e.sent(),this.menu.close(),[2]}}))}))},t.prototype.handleDialogOk=function(t){if(void 0===this.currentCell)throw new Error("currentCell is undefined");if(void 0===this.game)throw new Error("game is undefined");var e=this.currentCell;this.currentCell=void 0;var n=e.getState();if(this.enteringCandidates)return e.resetColorCandidates(),e.resetNumberCandidates(),t.forEach((function(t){if(t.type!==f.Type.color){var n=t.value;e.addNumberCandidate(n)}else{var r=t.value;e.addColorCandidate(r)}})),this.gameHistory.addEvent(new r(n,e.getState())),void this.update();e.setNumberGuess(void 0),e.setColorGuess(void 0),t.forEach((function(t){if(t.type!==f.Type.number){var n=t.value;e.setColorGuess(n)}else{var r=t.value;e.setNumberGuess(r)}})),this.gameHistory.addEvent(new r(n,e.getState())),this.update(),this.winCheck()},t.prototype.init=function(){return z(this,void 0,void 0,(function(){var t;return D(this,(function(e){switch(e.label){case 0:return t=this.levelManager.current(),[4,this.newGame(t)];case 1:return e.sent(),[2]}}))}))},t.prototype.newGame=function(t,e){return void 0===e&&(e=!1),z(this,void 0,void 0,(function(){var n;return D(this,(function(r){switch(r.label){case 0:return[4,x("./api/game/".concat(t,".json"))];case 1:return n=r.sent(),this.game=this.gameBuilder.build(n),this.gameView=new L(this.game),e||this.urlState.setLevel(t),this.levelManager.setLevel(t),this.update(),[2]}}))}))},t.prototype.winCheck=function(){var t;(null===(t=this.game)||void 0===t?void 0:t.isComplete())&&setTimeout((function(){return alert("Victory!")}),0)},t.prototype.closest=function(t,e){return t.matches(e)?t:null===t.parentElement?null:this.closest(t.parentElement,e)},t.prototype.handleHashChange=function(t){this.newGame(t,!0).catch((function(){alert("No such level: ".concat(t))}))},t.prototype.handleUndo=function(t){void 0===this.game||this.game.isComplete()||(this.game.getCell(t.coordinate).setState(t),this.update())},t.prototype.update=function(){var t,e;if(void 0!==this.game){null===(t=this.root.querySelector("#undo"))||void 0===t||t.classList.toggle("disabled",!this.gameHistory.hasUndo()),null===(e=this.root.querySelector("#redo"))||void 0===e||e.classList.toggle("disabled",!this.gameHistory.hasRedo());var n=this.gameElement.parentElement;n.removeChild(this.gameElement),this.gameElement.innerHTML="".concat(this.gameView),n.appendChild(this.gameElement)}},t}();const W=j;var Y="gameID";const V=function(){function t(t){this.storage=t}return t.prototype.setId=function(t){this.storage.setItem(Y,JSON.stringify(t))},t.prototype.getId=function(){var t=this.storage.getItem(Y);return null===t?null:JSON.parse(t)},t}();var F=["o3","o4","o5","tbt"],K=function(){function t(t){this.store=t}return t.prototype.setLevel=function(t){this.store.setId(t)},t.prototype.current=function(){var t;return null!==(t=this.store.getId())&&void 0!==t?t:"o3-1"},t.prototype.next=function(t){return e=this,n=void 0,i=function(){var e,n,r,i,o;return function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==l[0]&&2!==l[0])){s=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){s.label=l[1];break}if(6===l[0]&&s.label<i[1]){s.label=i[1],i=l;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(l);break}i[2]&&s.ops.pop(),s.trys.pop();continue}l=e.call(t,s)}catch(t){l=[6,t],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}}(this,(function(s){switch(s.label){case 0:if(null===(e=t.match(/^(o3|o4|o5|tbt)/)))throw new Error("Invalid level: ".concat(t));return n=e[1],r=t.replace(/(\d+)$/,(function(t,e){return"".concat(parseInt(e,10)+1)})),i=!0,[4,x("./api/game/".concat(r,".json")).catch((function(){i=!1}))];case 1:return s.sent(),i?[2,r]:(o=F.indexOf(n)+1)===F.length?[2,null]:[2,"".concat(F[o],"-1")]}}))},new((r=void 0)||(r=Promise))((function(t,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function l(t){try{c(i.throw(t))}catch(t){o(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(s,l)}c((i=i.apply(e,n||[])).next())}));var e,n,r,i},t}();const A=K,_=function(){function t(){this.gameEvents=[],this.redoStack=[],this.onUndo=function(){},this.registerEvents()}return t.prototype.addEvent=function(t){this.redoStack.length>0&&(this.redoStack=[]),this.gameEvents.push(t)},t.prototype.registerUndo=function(t){this.onUndo=t},t.prototype.registerEvents=function(){window.addEventListener("keyup",this.handleKeyUp.bind(this))},t.prototype.handleKeyUp=function(t){var e=t.key;(t.ctrlKey||t.metaKey)&&("z"===e&&this.undo(),"y"===e&&this.redo())},t.prototype.undo=function(){if(0!==this.gameEvents.length){var t=this.gameEvents.pop();this.redoStack.push(t),this.onUndo(t.before)}},t.prototype.redo=function(){if(0!==this.redoStack.length){var t=this.redoStack.pop();this.gameEvents.push(t),this.onUndo(t.after)}},t.prototype.hasUndo=function(){return this.gameEvents.length>0},t.prototype.hasRedo=function(){return this.redoStack.length>0},t}();var J=function(){function t(t,e){this.window=t,this.root=e,this.registerListeners(),this.onResize()}return t.prototype.onResize=function(){var t=this.window,e=t.innerWidth,n=t.innerHeight,r=Math.min(e,n);this.root.style.height="".concat(r,"px"),this.root.style.width="".concat(r,"px")},t.prototype.registerListeners=function(){this.window.addEventListener("resize",this.onResize.bind(this))},t}();const $=J;new W(window.document.getElementById("app"),new A(new V(window.localStorage)),new _,new $(window,window.document.getElementById("game"))).init()})();